## Context

Master-agent обрабатывает текстовые и голосовые сообщения от telegram-bot. Голосовые сообщения транскрибируются через VoiceClient, затем транскрипция передаётся в ADK Runner для генерации ответа с сохранением контекста сессии.

Telegram-bot также получает изображения от пользователей, но master-agent пока не умеет их обрабатывать. Gemini поддерживает multimodal input (текст + изображения).

## Goals / Non-Goals

**Goals:**
- Добавить endpoint `/api/image` для приёма изображений в base64
- Описывать содержимое изображения и отвечать на вопросы о нём
- Сохранять контекст сессии (изображение + ответ должны быть частью conversation history)

**Non-Goals:**
- OCR (распознавание текста на изображениях) — пока не требуется отдельно
- Обработка нескольких изображений в одном запросе
- Хранение изображений на сервере

## Decisions

### Decision 1: Расширить VoiceClient → MediaClient

**Выбор**: Переименовать `VoiceClient` в `MediaClient` и добавить метод `describe_image()`.

**Альтернатива**: Создать отдельный `ImageClient`.

**Обоснование**: Оба клиента используют один и тот же genai SDK и паттерн (multimodal content → generate_content). Объединение уменьшает дублирование кода.

### Decision 2: Image + optional prompt

**Выбор**: Endpoint принимает `image_base64` и опциональный `prompt` (вопрос о изображении).

**Формат запроса:**
```json
{
  "conversation_id": "tg_dm_123",
  "image_base64": "<base64>",
  "mime_type": "image/jpeg",
  "prompt": "Что изображено на этой картинке?",
  "metadata": {"telegram": {...}}
}
```

**Обоснование**: Позволяет как просто описать изображение (без prompt), так и задать конкретный вопрос.

### Decision 3: Интеграция с ADK Runner

**Выбор**: Аналогично voice — сначала описываем изображение через MediaClient, затем передаём описание + prompt в ADK Runner.

**Альтернатива**: Передавать image напрямую в ADK.

**Обоснование**: ADK Runner работает с текстовыми сообщениями. Описание изображения как текст сохраняет совместимость и позволяет вести диалог о картинке.

## Risks / Trade-offs

| Risk | Mitigation |
|------|------------|
| Большие изображения увеличивают latency | Telegram сжимает фото; можно добавить limit на размер |
| Описание теряет детали изображения | Достаточно для большинства use cases; можно улучшить prompt |
| Переименование VoiceClient может сломать импорты | Обновить все импорты в app.py и processor.py |
